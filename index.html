<!DOCTYPE html>
<html>
<head>
            <!-- Global site tag (gtag.js) - Google Analytics  -->
            <!-- 
            <script async src="https://www.googletagmanager.com/gtag/js?id=UA-124831747-1"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-124831747-1');
            </script>

            -->

    <meta charset="utf-8" />
    <title>RPG</title>

    <script>
        let charX = 0;
        let charY = 0;
        let SleepX;
        let SleepY;
        let PrevNode;
        let fields;
        let charInv = [];
        let charEnergy = 200;
        let charEnergyRefill = 200;
        
        let collectEnergy = 10;
        let jumpEnergy = 20;

        let charEq = {
            /*
            charEnergyRefill: 0,
            jumpEnergy: 0,
            collectEnergy: 0,
            */
            head: {
                item: {
                    charEnergyRefill: 0,
                    jumpEnergy: 0,
                    collectEnergy: 0,
                    //name: 0,
                    //tooltipText: 0,

                },
            },
            torso: {
                item: {
                    charEnergyRefill: 0,
                    jumpEnergy: 0,
                    collectEnergy: 0,
                },
            },
            gloves: {
                item: {
                    charEnergyRefill: 0,
                    jumpEnergy: 0,
                    collectEnergy: 0,
                },
            },
            legs: {
                item: {
                    charEnergyRefill: 0,
                    jumpEnergy: 0,
                    collectEnergy: 0,
                },
            },
            boots: {
                item: {
                    charEnergyRefill: 0,
                    jumpEnergy: 0,
                    collectEnergy: 0,
                },
            },
        };

        function EquipItem(bodypart,itemid) { // Equips an item, if the itemID is 0, it dequips the item
            
            for(i = 0; i < charInv.length; i++)
            {
                
                if(itemid == 0)
                {
                    AddItem(bodypart.item.id,1);
                    bodypart.item = {};
                    bodypart.item.charEnergyRefill = 0;
                    bodypart.item.jumpEnergy = 0;
                    bodypart.item.collectEnergy = 0;
                    charInventoryToggle();
                    charInventoryToggle();
                }
                if(itemid != 0 && charInv[i].id == itemid)
                {
                    if(bodypart.item.id == undefined)
                    {
                        bodypart.item = itemlist[itemid - 1];
                        charInv.splice(i,1);
                    }
                    else
                    {
                        AddItem(bodypart.item.id,1);
                        bodypart.item = itemlist[itemid - 1];
                        charInv.splice(charInv.findIndex((item) => {return item.id == itemid}),1);
                    }
                    charInventoryToggle();
                    charInventoryToggle();
                    
                }
            }
            Save();
        };
        

        let jumpEnergyPenalty = 0;
        let collectEnergyPenalty = 0;

        function GetcharEnergyRefill()
        {
            return charEnergyRefill + charEq.head.item.charEnergyRefill + charEq.torso.item.charEnergyRefill + charEq.gloves.item.charEnergyRefill + charEq.legs.item.charEnergyRefill + charEq.boots.item.charEnergyRefill;
        }
        function GetjumpEnergy()
        {
            let jenergy = jumpEnergy - charEq.head.item.jumpEnergy - charEq.torso.item.jumpEnergy - charEq.gloves.item.jumpEnergy - charEq.legs.item.jumpEnergy - charEq.boots.item.jumpEnergy + jumpEnergyPenalty;

            if(jenergy >= 0)
            {
                return jenergy;
            }
            else
            {
                return 0;
            }
        }
        function GetcollectEnergy()
        {
            let zenergy = collectEnergy - charEq.head.item.collectEnergy - charEq.torso.item.collectEnergy - charEq.gloves.item.collectEnergy - charEq.legs.item.collectEnergy - charEq.boots.item.collectEnergy + collectEnergyPenalty;

            if(zenergy >= 0)
            {
                return zenergy;
            }
            else
            {
                return 0;
            }
        }


        let itemlist = [
            {
                //1
                id: 1,
                name: "Gold Coin",
                value: 1,
                img:"coin.png",
                rarity: "gray",
                exp: 3,
            },
            {
                //2
                id: 2,
                name: "Small Energy Potion",
                value: 10,
                img: "smallEnergy.png",
                cb: 'charEnergy += 10; document.getElementById("charEnergy").innerHTML = charEnergy;                                 for(i = 0; i < charInv.length; i++){if(charInv[i].id == itemlist[1].id){charInv[i].amount -= 1;}}          Save();',
                rarity: "gray",
                exp: 3,
            },
            {
                //3
                id: 3,
                name: "Gold Piece",
                value: 40,
                img: "gPiece.png",
                rarity: "white",
                exp: 10,
            },
            {
                //4
                id: 4,
                name: "Jacket",
                value: 20,
                img: "jacket.png",
                cb: 'EquipItem(charEq.torso,4);',
                rarity: "white",
                exp: 10,
                equipable: true,
                tooltipText: "A basic Jakcet",

                charEnergyRefill: 10,
                jumpEnergy: 0.5,
                collectEnergy: 0.5,
            },
            {
                //5
                id: 5,
                name: "Helmet",
                value: 20,
                img: "helmet.png",
                cb: "EquipItem(charEq.head,5);",
                rarity: "white",
                exp: 10,
                equipable: true,
                tooltipText: "Basic Helmet",

                charEnergyRefill: 20,
                jumpEnergy: 0,
                collectEnergy: 0
            },
            {
                //6
                id:6,
                name: "Gloves",
                value: 20,
                img: "gloves.png",
                cb: "EquipItem(charEq.gloves,6);",
                rarity: "white",
                exp: 10,
                equipable: true,
                tooltipText: "Basic Gloves",

                charEnergyRefill: 0,
                jumpEnergy: 0,
                collectEnergy: 0.5
            },
            {
                //7
                id:7,
                name: "Leggings",
                value: 20,
                img: "leggings.png",
                cb: "EquipItem(charEq.legs,7);",
                rarity: "white",
                exp: 10,
                equipable: true,
                tooltipText: "Basic Legs",

                charEnergyRefill: 0,
                jumpEnergy: 0.75,
                collectEnergy: 0
            },
            {
                //8
                id:8,
                name: "Boots",
                value: 20,
                img: "boots.jpg",
                cb: "EquipItem(charEq.boots,8);",
                rarity: "white",
                exp: 10,
                equipable: true,
                tooltipText: "Basic boots",

                charEnergyRefill: 0,
                jumpEnergy: 0.75,
                collectEnergy: 0
            },
        ];

        let GeneralExp = 0;
        let GeneralL = 1;

        let collectExp = 0;
        let collectL = 1;
        let jumpExp = 0;
        let jumpL = 1;

        function collectLevel()
        {
            GeneralLevel();
            if(collectExp >= 250 && collectL < 2)
            {
                collectEnergy -= 0.5;
                collectL = 2;

                if(localStorage.collect2flag == "true")
                { }
                else
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 2 looting<br>Energy needed for looting reduced by 0.5";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.collectL = 2;
                    localStorage.collect2flag = true;
                }
            }
            if(collectExp >= 600 && collectL < 3)
            {
                collectEnergy -= 0.5;
                collectL = 3;

                if(localStorage.collect3flag == "true")
                { }
                else
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 3 looting<br>Energy needed for looting reduced by 0.5";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.collectL = 3;
                    localStorage.collect3flag = true;
                }
            }
            if(collectExp >= 1000 && collectL < 4)
            {
                collectEnergy -= 0.5;
                collectL = 4;

                if(localStorage.collect4flag == "true")
                { }
                else
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 4 looting<br>Energy needed for looting reduced by 0.5";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.collectL = 4;
                    localStorage.collect4flag = true;
                }
            }
            if(collectExp >= 1500 && collectL < 5)
            {
                collectEnergy -= 1;
                collectL = 5;

                if(localStorage.collect5flag == "true")
                { }
                else
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 5 looting<br>Energy needed for looting reduced by 1<br>10% chance to consume 50% less energy while looting";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.collectL = 5;
                    localStorage.collect5flag = true;
                }
            }

        }
        function JumpLevel()
        {
            GeneralLevel();
            if(jumpExp >= 250 && jumpL < 2)
            {
                jumpEnergy -= 1;
                jumpL = 2;

                if(localStorage.jump2flag != "true")
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 2 travelling<br>Energy needed for travelling reduced by 1";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.jumpL = 2;
                    localStorage.jump2flag = true;
                }
            }
            if(jumpExp >= 600 && jumpL < 3)
            {
                jumpEnergy -= 1;
                jumpL = 3;

                if(localStorage.jump3flag != "true")
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 3 travelling<br>Energy needed for travelling reduced by 1";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.jumpL = 3;
                    localStorage.jump3flag = true;
                }
            }
            if(jumpExp >= 1000 && jumpL < 4)
            {
                jumpEnergy -= 1;
                jumpL = 4;

                if(localStorage.jump4flag != "true")
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 4 travelling<br>Energy needed for travelling reduced by 1";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.jumpL = 4;
                    localStorage.jump4flag = true;
                }
            }
            if(jumpExp >= 1500 && jumpL < 5)
            {
                jumpEnergy -= 1;
                jumpL = 5;

                if(localStorage.jump5flag != "true")
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 5 travelling<br>Energy needed for travelling reduced by 1<br>10% chance to consume 50% less energy while travelling";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.jumpL = 5;
                    localStorage.jump5flag = true;
                }
            }
        }
        function GeneralLevel()
        {
            if(GeneralExp >= 500 && GeneralL < 2)
            {
                charEnergyRefill += 25;
                
                GeneralL = 2;
                if(localStorage.general2flag != "true")
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 2 character<br>Energy increased by 25";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.generalL = 2;
                    localStorage.general2flag = true;
                }
            }
            if(GeneralExp >= 1000 && GeneralL < 3)
            {
                charEnergyRefill += 25;
                
                GeneralL = 3;
                if(localStorage.general3flag != "true")
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 3 character<br>Energy increased by 25";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.generalL = 3;
                    localStorage.general3flag = true;
                }
            }
            if(GeneralExp >= 1500 && GeneralL < 4)
            {
                charEnergyRefill += 25;
                
                GeneralL = 4;
                if(localStorage.general4flag != "true")
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 4 character<br>Energy increased by 25";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.generalL = 4;
                    localStorage.general4flag = true;
                }
            }
            if(GeneralExp >= 2500 && GeneralL < 5)
            {
                charEnergyRefill += 100;
                
                GeneralL = 5;
                if(localStorage.general5flag != "true")
                {
                    document.getElementById("Msg").childNodes[0].innerHTML = "Level 5 character<br>Energy increased by 100";
                    document.getElementById("Msg").style.display = "block";
                    localStorage.generalL = 5;
                    localStorage.general5flag = true;
                }
            }
        }
        function GetMaxExpcollect()
        {
            switch(collectL)
            {
                default:
                    return "MAX"
                case 1:
                    return 250;
                break;
                case 2:
                    return 600;
                break;
                case 3:
                    return 1000;
                break;
                case 4:
                    return 1500;
                break;
            }
        }
        function GetMaxExpJump()
        {
            switch(jumpL)
            {
                default:
                    return "MAX"
                case 1:
                    return 250;
                break;
                case 2:
                    return 600;
                break;
                case 3:
                    return 1000;
                break;
                case 4:
                    return 1500;
                break;
            }
        }
        function GetMaxExpGeneral()
        {
            switch(GeneralL)
            {
                default:
                    return "MAX"
                case 1:
                    return 500;
                break;
                case 2:
                    return 1000;
                break;
                case 3:
                    return 1500;
                break;
                case 4:
                    return 2500;
                break;
            }
        }

        function InvReset(rmode)
        {
                                
                                if(event.target.className == "name")
                                {
                                    if(event.target.parentNode.className != "invItemUsable")event.target.parentNode.style.display = "none";
                                    if(rmode != 1)
                                    {
                                            let collectRandom = Math.random();
                                            if(collectL >= 5)
                                            {
                                                if(collectRandom > 0.90)
                                                {
                                                    charEnergy -= GetcollectEnergy() / 2;
                                                    collectLevel();
                                                }
                                                else
                                                {
                                                    charEnergy -= GetcollectEnergy();
                                                    collectLevel();
                                                }
                                            }
                                            else
                                            {
                                                charEnergy -= GetcollectEnergy();
                                                    collectLevel();
                                            }
                                            
                                    }
                                    document.getElementById("charEnergy").innerHTML = charEnergy.toFixed(2);
                                }
                                if(event.target.tagName == "IMG")
                                {
                                    if(event.target.className != "craftingImg" && event.target.parentNode.className != "invItemUsable") event.target.parentNode.style.display = "none";
                                    if(rmode != 1)
                                    {
                                        let collectRandom = Math.random();
                                            if(collectL >= 5)
                                            {
                                                if(collectRandom > 0.90)
                                                {

                                                    charEnergy -= GetcollectEnergy() / 2;
                                                    collectLevel();
                                                }
                                                else
                                                {
                                                    charEnergy -= GetcollectEnergy();
                                                    collectLevel();
                                                }
                                            }
                                            else
                                            {
                                                charEnergy -= GetcollectEnergy();
                                                    collectLevel();
                                            }
                                    }
                                    document.getElementById("charEnergy").innerHTML = charEnergy.toFixed(2);
                                }
                                if(event.target.className == "lootitem")
                                {
                                    event.target.style.display = "none";
                                    if(rmode != 1)
                                    {
                                        let collectRandom = Math.random();
                                            if(collectL >= 5)
                                            {
                                                if(collectRandom > 0.90)
                                                {
                                                    charEnergy -= GetcollectEnergy() / 2;
                                                    collectLevel();
                                                }
                                                else
                                                {
                                                    charEnergy -= GetcollectEnergy();
                                                    collectLevel();
                                                }
                                            }
                                            else
                                            {
                                                charEnergy -= GetcollectEnergy();
                                                    collectLevel();
                                            }
                                    }
                                    document.getElementById("charEnergy").innerHTML = charEnergy.toFixed(2);
                                }

                                if(document.getElementById("charInv").style.display != "none")
                                {
                                    charInventoryToggle(1);
                                    charInventoryToggle(1);
                                    collectLevel();
                                }
                                Save();
        }
        function AddItem(item,resetmode) {
            if(charEnergy >= GetcollectEnergy() && item)
            {
                let clone = JSON.parse(JSON.stringify(itemlist[item - 1]));
                if(charInv.filter((inv) => {return inv.id == clone.id})[0] != undefined && clone.equipable != true)
                {
                    
                    for(i = 0; i < charInv.length; i++)
                    {
                        
                        if(charInv[i].id == clone.id)
                        {
                            if(charInv[i].amount == undefined)
                            {
                                if(resetmode != 1)
                                {
                                collectExp += charInv[i].exp;
                                GeneralExp += charInv[i].exp;
                                }
                                    charInv[i].amount = 1;
                                InvReset(resetmode);
                                break;
                            }
                            else
                            {
                                charInv[i].amount += 1;
                                if(resetmode != 1)
                                {
                                collectExp += charInv[i].exp;
                                GeneralExp += charInv[i].exp;
                                }
                                InvReset(resetmode);
                                break;
                            }
                        }
                    }
                }
                else
                {
                    let pushIndex = charInv.push(clone) - 1;
                    if(charInv[pushIndex].amount == undefined)
                    {
                        charInv[pushIndex].amount = 1;
                        if(resetmode != 1)
                        {
                        collectExp += charInv[pushIndex].exp;
                        GeneralExp += charInv[pushIndex].exp;
                        }
                        InvReset(resetmode);
                    }
                    else
                    {
                        charInv[pushIndex].amount += 1;
                        // if(resetmode != 1)
                        {
                        collectExp += charInv[pushIndex].exp;
                        GeneralExp += charInv[pushIndex].exp;
                        }
                        InvReset(resetmode);
                    }
                }
                
            }
        }


        function GenerateLoot(min,max,lootlist,coords)
        {
            let amount = Math.floor(Math.random() * (max - min + 1) + min);
            let itemid;
            let loothtml = `<div class="loot"> <img class="close" src="img/exit.png" onclick="closeloot('${coords}')" />`;
            let weights = 0;
            let lootlist_ = [];
            
            for(i = 0; i < lootlist.length; i++)
            {
                weights += lootlist[i].amount;
            }
            for(k = 0; k < amount; k++)
            {
                let weightrand = Math.random() * weights + 1;
                let wrandsubtr;
                
                for(j = 0; j < lootlist.length; j++)
                {

                    weightrand -= lootlist[j].amount;
                    if(weightrand - lootlist[j].amount <= 0)
                    {
                        
                        lootlist_.push(lootlist[j].item);
                        loothtml += `<div class="lootitem"  style="border-right:${itemlist[lootlist[j].item - 1].rarity} 1px solid" onclick="AddItem(${lootlist[j].item})"><img  src="img/${itemlist[lootlist[j].item - 1].img}" /><span class="name">${itemlist[lootlist[j].item - 1].name}</span></div>`; 
                        break;
                    }

                }

            }

            
            loothtml += `</div>`;
            return loothtml;
        }
                        function BasicGen(coord)
                        {
                            return GenerateLoot(                                    3,5,[{item:1, amount:40,},
                                                                                        {item:2, amount:35,},
                                                                                        {item:3, amount:35,},
                                                                                        {item:4, amount:32,},
                                                                                        {item:5, amount:32,},
                                                                                        {item:6, amount:10,},
                                                                                        {item:7, amount:3,},
                                                                                        {item:7, amount:3,}, ],
                                                                                        coord);
                        }
                        function ChestSpec1(coord) //5,1
                        {
                            return GenerateLoot(                                         10,10,[{item:1, amount:40,},
                                                                                        {item:2, amount:35,},
                                                                                        {item:3, amount:35,},
                                                                                        {item:4, amount:32,},
                                                                                        {item:5, amount:32,},
                                                                                        {item:6, amount:20,},
                                                                                        {item:7, amount:6,},
                                                                                        {item:8, amount:4,},
                                                                                        ],
                                                                                        coord);
                        }
        function MapHTML(fields) 
        {
            // document.getElementById("map").innerHTML = `<div class="laweczka" style=" left:5vw;                 top:15vh">Ławeczka</div>      <div class="${fields[0][0]}" style="left:20vw; top:30vh;" onclick="Jump(1,1)" id="1,1">${BasicGen("1,1")}</div><div class="${fields[1][0]}" style="left:40vw; top:30vh;" onclick="Gen("3,1")}</div><div class="${fields[3][0]}" style="left:20vw; top:50vh;" onclick="Jump(1,2)" id="1,2">${BasicGen("1,2")}</div><div Jump(2,1)" id="2,1">${BasicGen("2,1")}</div><div class="${fields[2][0]}" style="left:60vw; top:30vh;" onclick="Jump(3,1)" id="3,1">${Basicclass="${fields[4][0]}" style="left:40vw; top:50vh;" onclick="Jump(2,2)" id="2,2">${BasicGen("2,2")}</div><div class="${fields[5][0]}" style="left:60vw; top:50vh;" onclick="Jump(3,2)" id="3,2">${BasicGen("3,2")}</div><div class="${fields[6][0]}" style="left:20vw; top:70vh;" onclick="Jump(1,3)" id="1,3">${BasicGen("1,3")}</div><div class="${fields[7][0]}" style="left:40vw; top:70vh;" onclick="Jump(2,3)" id="2,3">${BasicGen("2,3")}</div> <div class="${fields[13][0]}" style="left:40vw; top:90vh;" onclick="Jump(2,4)" id="2,4">  </div> <div class="${fields[13][0]}" style="left:40vw; top:110vh;" onclick="Jump(2,5)" id="2,5">  </div> <div class="${fields[13][0]}" style="left:40vw; top:130vh;" onclick="Jump(2,6)" id="2,6">  </div> <div class="${fields[8][0]}" style="left:60vw; top:70vh;" onclick="Jump(3,3)" id="3,3">${BasicGen("3,3")}</div><div class="${fields[9][0]}" style="left:80vw; top:70vh;" onclick="Jump(4,3)" id="4,3"></div><div class="${fields[10][0]}" style="left:95vw; top:70vh;" onclick="Jump(5,3)" id="5,3"></div>    <div class="${fields[11][0]}" style="left:95vw; top:50vh;" onclick="Jump(5,2)" id="5,2"></div>  <div class="${fields[12][0]}" style="left:95vw; top:30vh;" onclick="Jump(5,1)" id="5,1">${fields[12][1]}</div>`;
            
            let map = '';

            for(l = 0; l < fields.length; l++)
            {
                map += `<div class="${fields[l].class}" style="left:${fields[l].posX * 20}vw; top:${fields[l].posY  * 20}vh" ${/* fields[l].class == "laweczka" ? "" : */ "onclick='" + "Jump(" + fields[l].posX  + "," + fields[l].posY + ")'"} id="${fields[l].posX + ',' + fields[l].posY}" /> <img src="img/${fields[l].class}.png" class="${fields[l].class}"/> ${(fields[l].class == "laweczka") ? " " : (fields[l].class == "chest" || "") && GenerateLoot(fields[l].lootmin,fields[l].lootmax,fields[l].itemlist,fields[l].posX+","+fields[l].posY)} </div>`;
            }
            
            
            document.getElementById("map").innerHTML = map;
        }
        function MapGenerate(name)
        {
            switch(name)
            {
                case "first":
                document.getElementById("map").style.opacity = 0;

                
                if(SleepX == undefined && SleepY == undefined)
                {
                    SleepX = 1;
                    SleepY = 1;
                }
                charX = SleepX;
                charY = SleepY;

                

                setTimeout(() => {
                    charEnergy = GetcharEnergyRefill();
                    document.getElementById('charEnergy').innerHTML = charEnergy;
                



                    let BasicChest1 = {class: "chest", lootmin: 3, lootmax: 5, itemlist: [
                    {item:1, amount:40,},
                    {item:2, amount:20,},
                    {item:3, amount:20,},
                    {item:4, amount:20,},
                    {item:5, amount:20,},
                    {item:6, amount:15,},
                    {item:7, amount:2,},
                    {item:8, amount:1,},
                    ]};
                    let BasicChest2 = {class: "chest", lootmin: 3, lootmax: 5, itemlist: [
                    {item:1, amount:40,},
                    {item:2, amount:20,},
                    {item:3, amount:20,},
                    {item:4, amount:20,},
                    {item:5, amount:20,},
                    {item:6, amount:15,},
                    {item:7, amount:2,},
                    {item:8, amount:1,},
                    ]};

                    let SpecChest1 = {class: "chest", lootmin: 10, lootmax: 10, itemlist: [
                    {item:1, amount:40,},
                    {item:2, amount:20,},
                    {item:3, amount:20,},
                    {item:4, amount:20,},
                    {item:5, amount:20,},
                    {item:6, amount:15,},
                    {item:7, amount:1,},
                    {item:8, amount:0.5,},
                    ]};
                    let SpecChest2 = {class: "chest", lootmin: 5, lootmax: 5, itemlist: [
                    {item:2, amount:50,},
                    {item:3, amount:50,},
                    {item:4, amount:50,},
                    {item:5, amount:50,},
                    {item:6, amount:23,},
                    {item:7, amount:5,},
                    {item:8, amount:4,},
                    ]};
                    
                    MapHTML(
                        [
                            // pierwsza czesc mapy
                        {class: "laweczka", posX:1, posY:1, coord: "1,1"},
                        Math.random() > 0.7 ? {class: "chest", posX:2, posY:2, lootmin: 3, lootmax: 5, itemlist: BasicChest1.itemlist} : {class: "puste", posX:2, posY:2},

                        Math.random() > 0.7 ? {class: "chest", posX:3, posY:2, lootmin: 3, lootmax: 5, itemlist: BasicChest1.itemlist} : {class: "puste", posX:3, posY:2},

                        Math.random() > 0.7 ? {class: "chest", posX:4, posY:2, lootmin: 3, lootmax: 5, itemlist: BasicChest1.itemlist} : {class: "puste", posX:4, posY:2},

                        Math.random() > 0.7 ? {class: "chest", posX:2, posY:3, lootmin: 3, lootmax: 5, itemlist: BasicChest1.itemlist} : {class: "puste", posX:2, posY:3},

                        Math.random() > 0.7 ? {class: "chest", posX:3, posY:3, lootmin: 3, lootmax: 5, itemlist: BasicChest1.itemlist} : {class: "puste", posX:3, posY:3},
                        
                        Math.random() > 0.7 ? {class: "chest", posX:4, posY:3, lootmin: 3, lootmax: 5, itemlist: BasicChest1.itemlist} : {class: "puste", posX:4, posY:3},

                        Math.random() > 0.7 ? {class: "chest", posX:2, posY:4, lootmin: 3, lootmax: 5, itemlist: BasicChest1.itemlist} : {class: "puste", posX:2, posY:4},

                        Math.random() > 0.7 ? {class: "chest", posX:3, posY:4, lootmin: 3, lootmax: 5, itemlist: BasicChest1.itemlist} : {class: "puste", posX:3, posY:4},

                        Math.random() > 0.7 ? {class: "chest", posX:4, posY:4, lootmin: 3, lootmax: 5, itemlist: BasicChest1.itemlist} : {class: "puste", posX:4, posY:4},

                        // przejscie na druga czesc mapy
                        {class: "puste", posX:3, posY:5},
                        {class: "puste", posX:3, posY:6},
                        {class: "puste", posX:3, posY:7},
                        {class: "puste", posX:3, posY:8},
                        {class: "puste", posX:3, posY:9},
                        {class: "puste", posX:4, posY:9},
                        {class: "puste", posX:5, posY:9},
                        {class: "puste", posX:6, posY:9},
                        {class: "puste", posX:7, posY:9},
                        {class: "puste", posX:8, posY:9},
                        {class: "puste", posX:8, posY:10},
                        {class: "puste", posX:8, posY:11},
                        {class: "puste", posX:8, posY:12},
                        {class: "puste", posX:8, posY:13},

                        //druga czesc mapy
                        Math.random() > 0.6 ? {class: "chest", posX:6, posY:14, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:6, posY:14},
                        Math.random() > 0.6 ? {class: "chest", posX:7, posY:14, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:7, posY:14},
                        Math.random() > 0.6 ? {class: "chest", posX:8, posY:14, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:8, posY:14},
                        Math.random() > 0.6 ? {class: "chest", posX:9, posY:14, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:9, posY:14},
                        Math.random() > 0.6 ? {class: "chest", posX:10, posY:14, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:10, posY:14},
                        {class: "laweczka", posX: 11, posY: 14},
                        Math.random() > 0.6 ? {class: "chest", posX:6, posY:15, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:6, posY:15},
                        Math.random() > 0.6 ? {class: "chest", posX:7, posY:15, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:7, posY:15},
                        Math.random() > 0.6 ? {class: "chest", posX:8, posY:15, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:8, posY:15},
                        Math.random() > 0.6 ? {class: "chest", posX:9, posY:15, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:9, posY:15},
                        Math.random() > 0.6 ? {class: "chest", posX:10, posY:15, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:10, posY:15},
                        Math.random() > 0.6 ? {class: "chest", posX:6, posY:16, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:6, posY:16},
                        Math.random() > 0.6 ? {class: "chest", posX:7, posY:16, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:7, posY:16},
                        Math.random() > 0.6 ? {class: "chest", posX:8, posY:16, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:8, posY:16},
                        Math.random() > 0.6 ? {class: "chest", posX:9, posY:16, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:9, posY:16},
                        Math.random() > 0.6 ? {class: "chest", posX:10, posY:16, lootmin: 3, lootmax: 5, itemlist: BasicChest2.itemlist} : {class: "puste", posX:10, posY:16},
                        
                        {class: "puste", posX:5, posY:15},
                        {class: "puste", posX:4, posY:15},
                        {class: "puste", posX:3, posY:15},
                        {class: "chest", posX:2, posY:15, lootmin: 5, lootmax: 5, itemlist: SpecChest2.itemlist},

                        {class: "puste", posX:6, posY:17},
                        {class: "puste", posX:5, posY:17},
                        {class: "puste", posX:4, posY:17},
                        {class: "puste", posX:3, posY:17},
                        {class: "chest", posX:2, posY:17, lootmin: 5, lootmax: 5, itemlist: SpecChest2.itemlist},

                        {class: "puste", posX:11, posY:16},
                        {class: "puste", posX:12, posY:16},
                        {class: "puste", posX:13, posY:16},
                        {class: "chest", posX:14, posY:16, lootmin: 5, lootmax: 5, itemlist: SpecChest2.itemlist},

                        {class: "puste", posX:10, posY:17},
                        {class: "puste", posX:10, posY:18},
                        {class: "puste", posX:11, posY:18},
                        {class: "puste", posX:12, posY:18},
                        {class: "chest", posX:13, posY:18, lootmin: 10, lootmax: 10, itemlist: SpecChest1.itemlist},

                        {class: "puste", posX:5, posY:4},
                        {class: "puste", posX:6, posY:4},
                        {class: "puste", posX:6, posY:3},
                        {class: "chest", posX:6, posY:2, lootmin: 10, lootmax: 10, itemlist: SpecChest1.itemlist},


                        //{class: "zlom", posX:4, posY:5},
                        ]);

                    document.getElementById("map").scrollTop = document.getElementById(`${charX},${charY}`).offsetTop - window.innerHeight * 0.5;
                    document.getElementById("map").scrollLeft = document.getElementById(`${charX},${charY}`).offsetLeft - window.innerWidth * 0.5;

                    document.getElementById("map").style.opacity = 1;
                },1000);

                break;
            }
        }
        

        function Jump(x,y,exp)
        {
            if(x - charX >= -1 && x - charX <= 1)
            {
                if(y - charY >= -1 && y - charY <= 1)
                {
                    if(event.target.className == "laweczka")
                        {
                            SleepX = x;
                            SleepY = y;
                            
                        }
                    else if(charEnergy >= GetjumpEnergy())
                    {
                        //3vw      20vw/vh

                        if(document.getElementById(`${charX},${charY}`) && document.getElementById(`${charX},${charY}`).className != "laweczka")
                        {
                            document.getElementById(`${charX},${charY}`).children[0].style.boxShadow = "";
                            document.getElementById(`${charX},${charY}`).getElementsByTagName('img')[0].style.filter = "grayscale(90%)";
                            if(document.getElementById(`${charX},${charY}`).className == "chest" && document.getElementById(`${charX},${charY}`).childNodes.length != 0)
                                {
                                    if(event.target.className == "close")
                                    {
                                        document.getElementById(`${charX},${charY}`).getElementsByClassName("loot")[0].style.display = "none";
                                    }
                                    if(event.target.className == "chest" || event.target.className == "puste" || event.target.className == "zlom")
                                    {
                                        document.getElementById(`${charX},${charY}`).getElementsByClassName("loot")[0].style.display = "none";
                                    }
                                }
                        }
                        
                        if(event.target.className != "close" && event.target.className != "loot" && event.target.className != "lootitem" && event.target.className != "name" && event.target.parentNode.className != "lootitem")
                        {
                            
                            if(event.target != document.getElementById(`${charX},${charY}`))
                            {
                                if(jumpL >= 5 && Math.random() > 0.90)
                                {
                                    charEnergy -= GetjumpEnergy() / 2;
                                }
                                else
                                {
                                    charEnergy -= GetjumpEnergy();
                                }
                                if(!exp)
                                {
                                    jumpExp += 10;
                                    GeneralExp += 10;
                                }
                            }
                                document.getElementById("charEnergy").innerHTML = charEnergy;
                                JumpLevel();
                        }
                        // Zmiana pozycji postaci
                        charX = x;
                        charY = y;

                            document.getElementById("map").scrollTop = document.getElementById(`${charX},${charY}`).offsetTop - window.innerHeight * 0.5;
                            document.getElementById("map").scrollLeft = document.getElementById(`${charX},${charY}`).offsetLeft - window.innerWidth * 0.5;
                        
                        
                        prevNode = document.getElementById(`${charX},${charY}`).style.backgroundColor;
                        
                        document.getElementById(`${charX},${charY}`).children[0].style.boxShadow = "0px 0px 2vw red";



                        if(document.getElementById(`${charX},${charY}`).className == "chest" && document.getElementById(`${charX},${charY}`).childNodes.length != 0)
                        {
                            if(event.target.className == "chest" && event.target.className != "lootitem")
                            {
                                document.getElementById(`${charX},${charY}`).getElementsByClassName("loot")[0].style.display = "block";
                            }
                        }
                        
                    }
                }
            }
            Save();
        }
        function closeloot(id)
        {
            document.getElementById(id).getElementsByClassName("loot")[0].style.display = "none";
        }
        function charInventoryToggle(mode) {
            if(document.getElementById("craftingMenu").style.visibility == "hidden")
            {
            charInv = charInv.filter((item) => { return item.amount > 0;});
            if(document.getElementById('charInv').style.display == "none")
            {
                // Equipped Items Generation
                document.getElementById('charInv').innerHTML += "<div id='charEquipped'>"
                
                document.getElementById('charEquipped').innerHTML += (charEq.head.item.id || '') ? `<div class="charEqItem" onclick="EquipItem(charEq.head,0);">  <img class="charEqImg" src="img/${charEq.head.item.img}"/>  <div class="charEqName">${charEq.head.item.name}</div>          <div class="charEqTooltip">${charEq.head.item.tooltipText} </br> Energy po spaniu: ${charEq.head.item.charEnergyRefill} </br> Energy do looting: ${charEq.head.item.collectEnergy} </br> Energy do podróży: ${charEq.head.item.jumpEnergy}</div> </div>`   :    '<div class="charEqItem"> Głowa: <div class="charEqNameNoItem" style="    "> No Item </div>';

                document.getElementById('charEquipped').innerHTML += (charEq.torso.item.id || '') ? `<div class="charEqItem" onclick="EquipItem(charEq.torso,0);">  <img class="charEqImg" src="img/${charEq.torso.item.img}"/>  <div class="charEqName">${charEq.torso.item.name}</div>          <div class="charEqTooltip">${charEq.torso.item.tooltipText} </br> Energy po spaniu: ${charEq.torso.item.charEnergyRefill} </br> Energy do looting: ${charEq.torso.item.collectEnergy} </br> Energy do podróży: ${charEq.torso.item.jumpEnergy}</div> </div>`   :    '<div class="charEqItem"> Ciało: <div class="charEqNameNoItem" style="position: absolute; left:4vw; top:-1vh;"> No Item </div>';

                document.getElementById('charEquipped').innerHTML += (charEq.gloves.item.id || '') ? `<div class="charEqItem" onclick="EquipItem(charEq.gloves,0);">  <img class="charEqImg" src="img/${charEq.gloves.item.img}"/>  <div class="charEqName">${charEq.gloves.item.name}</div>          <div class="charEqTooltip">${charEq.gloves.item.tooltipText} </br> Energy po spaniu: ${charEq.gloves.item.charEnergyRefill} </br> Energy do looting: ${charEq.gloves.item.collectEnergy} </br> Energy do podróży: ${charEq.gloves.item.jumpEnergy}</div> </div>`   :    '<div class="charEqItem"> Dłonie: <div class="charEqNameNoItem" style="position: absolute; left:4vw; top:-1vh;"> No Item </div>';

                document.getElementById('charEquipped').innerHTML += (charEq.legs.item.id || '') ? `<div class="charEqItem" onclick="EquipItem(charEq.legs,0);">  <img class="charEqImg" src="img/${charEq.legs.item.img}"/>  <div class="charEqName">${charEq.legs.item.name}</div>          <div class="charEqTooltip">${charEq.legs.item.tooltipText} </br> Energy po spaniu: ${charEq.legs.item.charEnergyRefill} </br> Energy do looting: ${charEq.legs.item.collectEnergy} </br> Energy do podróży: ${charEq.legs.item.jumpEnergy}</div> </div>`   :    '<div class="charEqItem"> Nogi: <div class="charEqNameNoItem" style="position: absolute; left:4vw; top:-1vh;"> No Item </div>';

                document.getElementById('charEquipped').innerHTML += (charEq.boots.item.id || '') ? `<div class="charEqItem" onclick="EquipItem(charEq.boots,0);">  <img class="charEqImg" src="img/${charEq.boots.item.img}"/>  <div class="charEqName">${charEq.boots.item.name}</div>          <div class="charEqTooltip">${charEq.boots.item.tooltipText} </br> Energy po spaniu: ${charEq.boots.item.charEnergyRefill} </br> Energy do looting: ${charEq.boots.item.collectEnergy} </br> Energy do podróży: ${charEq.boots.item.jumpEnergy}</div> </div>`   :    '<div class="charEqItem"> Buty: <div class="charEqNameNoItem" style="position: absolute; left:4vw; top:-1vh;"> No Item </div>';

                
                document.getElementById('charInv').innerHTML += "<div id='charItems'>";
                for(i = 0; i < charInv.length; i++)
                {
                            let usable;
                            if(charInv[i].amount <= 0)
                            {  

                            }
                            else
                            {
                                if(charInv[i].cb)
                                {                        
                                    usable = "Usable";
                                    document.getElementById('charItems').innerHTML += `<div class="invItem${usable}" style='border-right:${charInv[i].rarity} 5px solid'   onclick='${charInv[i].cb}'><img  src="img/${charInv[i].img}"/>     <div class="name" >${charInv[i].name}</div><div class="value"  >Value: ${charInv[i].value}</div>  <div class="amount"  >x${charInv[i].amount}</div>  </div>`;
                                }
                                else
                                {
                                    usable = "Unusable";
                                    document.getElementById('charItems').innerHTML += `<div class="invItem${usable}" style='border-right:${charInv[i].rarity} 5px solid' ><img  src="img/${charInv[i].img}"/>     <div class="name">${charInv[i].name}</div><div class="value">Value: ${charInv[i].value}</div>  <div class="amount">x${charInv[i].amount}</div>  </div>`;
                                }
                            }
                            if(charInv.length - i == 1)
                            {
                                document.getElementById('charInv').innerHTML += "</div>";
                            }
                }
                document.getElementById('charInv').style.display = "block";
                document.getElementById('charInv').style.left = "1vw";
                
                document.getElementById("StatsToggle").style.zIndex = 1;
                document.getElementById('charInvToggle').style.left = "38vw";
            }
            else
            {
                
                document.getElementById('charInv').style.display = "none";
                document.getElementById('charInv').innerHTML = "";
                document.getElementById("StatsToggle").style.zIndex = 3;
                //document.getElementById('charInv').style.left = "-38vw";
                document.getElementById('charInvToggle').style.left = "1vw";
                
            }
            }
            console.log(mode);
        }
        let crafting = {
            left: "no",
            right: "no",
        };
        let prevCraftSlot;
        function OpenCrafting(slot) {
            let charInvEl = document.getElementById('charInv');
            if(charInvEl.style.display == "none")
            {
                charInvEl.innerHTML = "";
                charInvEl.style.display = "block";
                charInvEl.innerHTML += "<div id='charItems'>";
                for(i = 0; i < charInv.length; i++)
                {
                            let usable;
                            if(charInv[i].amount <= 0)
                            {  

                            }
                            else
                            {                                            
                                document.getElementById('charItems').innerHTML += `<div class="invItemUsable" style='border-right:${charInv[i].rarity} 5px solid'   onclick='CraftingSet(${charInv[i].id}, "${slot}")'><img  src="img/${charInv[i].img}"/>     <div class="name" >${charInv[i].name}</div><div class="value"  >Value: ${charInv[i].value}</div>  <div class="amount"  >x${charInv[i].amount}</div>  </div>`;
                            }
                            if(charInv.length - i == 1)
                            {
                                charInvEl.innerHTML += "</div>";
                            }
                }
            }
            else if(prevCraftSlot == slot)
            {
                
                charInvEl.style.display = "none";
                charInvEl.innerHTML = "";
                
            }
            else {
                charInvEl.style.display = "block";
                charInvEl.innerHTML = "";
                charInvEl.innerHTML += "<div id='charItems'>";
                for(i = 0; i < charInv.length; i++)
                {
                            let usable;
                            if(charInv[i].amount <= 0)
                            {  

                            }
                            else
                            {                                            
                                    document.getElementById('charItems').innerHTML += `<div class="invItemUsable" style='border-right:${charInv[i].rarity} 5px solid'   onclick='CraftingSet(${charInv[i].id}, "${slot}")'><img  src="img/${charInv[i].img}"/>     <div class="name" >${charInv[i].name}</div><div class="value"  >Value: ${charInv[i].value}</div>  <div class="amount"  >x${charInv[i].amount}</div>  </div>`;
                            }
                            if(charInv.length - i == 1)
                            {
                                charInvEl.innerHTML += "</div>";
                            }
                }
            }
            prevCraftSlot = slot;
        }
        function CraftingSet(id, slotClass) {
            slotClass == "Left" ? crafting.left = id - 1: crafting.right = id - 1;

            let ids = Object.values(crafting);
            console.log(ids);

            document.querySelector(`#craftingMenu #${slotClass}Item`).innerHTML = `<img class="craftingImg" src="img/${itemlist[id - 1].img}">`;
            document.getElementById("charInv").style.display = "none";
            // Napierdalanie przedmiotów
            if(ids.includes(20) && ids.includes(21)) {
                SetCraftResult(20,21,22);
            }

            //Zlewy z piwa kurwa napierdalaaaamyyyyy
            if(ids[0] == 2 && ids[1] == 2) // Cwiartka karpackie puszka
            {
                SetCraftResult(2,2,23,0);
            }
            if(ids[0] == 23 && ids[1] == 23) // polowka karpackie puszka
            {
                SetCraftResult(23,23,24,0);
            }
            if(ids[0] == 24 && ids[1] == 24) // cala karpackie puszka
            {
                SetCraftResult(24,24,25,0);
            }
            if(ids[0] == 1 && ids[1] == 1) // Cwiartka szlacheckie puszka
            {
                SetCraftResult(1,1,26,0);
            }
            if(ids[0] == 26 && ids[1] == 26) // polowka szlacheckie puszka
            {
                SetCraftResult(26,26,27,0);
            }
            if(ids[0] == 27 && ids[1] == 27) // cala szlacheckie puszka
            {
                SetCraftResult(27,27,28,0);
            }
        }
        function SetCraftResult(matid1,matid2,resid,resid2) // material id, result id
        {
            document.querySelector("#craftingMenu #craftingResult").innerHTML = `<img class="craftingImg" src="img/${itemlist[resid].img}" onclick="RemoveItem(${matid1 + 1}); RemoveItem(${matid2 + 1}); AddItem(${resid + 1},1); AddItem(${resid2 + 1}, 1); CraftingEnd();" />`
        }
        function RemoveItem(id) {
            for(i = 0; i < charInv.length; i++) {
                if(charInv[i].id == id) {
                    if(charInv[i].amount == 1) {
                        charInv[i].amount = 0;
                    }
                    else {
                        charInv[i].amount--;
                    }
                }
            }
        }
        function CraftingEnd() {
            document.querySelector("#craftingMenu #craftingResult").innerHTML = "";
            document.querySelector("#craftingMenu #LeftItem").innerHTML = "";
            document.querySelector("#craftingMenu #RightItem").innerHTML = "";
            crafting.left = "no";
            crafting.right = "no";
        }
        function StatsToggle()
        {

            if(document.getElementById('stats').style.display == "none")
            {
                document.getElementById('stats').innerHTML = `Character Level: ${GeneralL} &nbsp; &nbsp; &nbsp; ${GeneralExp}/${GetMaxExpGeneral()}<br><br>Looting Level: ${collectL}  &nbsp; &nbsp; &nbsp; ${collectExp}/${GetMaxExpcollect()}<br><br>Travel Level: ${jumpL}&nbsp; &nbsp; &nbsp; ${jumpExp}/${GetMaxExpJump()}`;

                document.getElementById('charInvToggle').style.zIndex = 1;
                document.getElementById('stats').style.display = "block";
                document.getElementById('StatsToggle').style.left = "37vw";
            }
            else
            {
                document.getElementById('stats').style.display = "none";
                document.getElementById('charInvToggle').style.zIndex = 3;
                document.getElementById('StatsToggle').style.left = "14vw";
            }
        }
        function Save()
        {
            localStorage.charInv = JSON.stringify(charInv);
            localStorage.charEq = JSON.stringify(charEq);

            localStorage.collectExp = collectExp;
            localStorage.collectL = collectL;
            localStorage.jumpExp = jumpExp;
            localStorage.jumpL = jumpL;
            localStorage.GeneralExp = GeneralExp;
            localStorage.GeneralL = GeneralL;
            localStorage.SleepX = SleepX;
            localStorage.SleepY = SleepY;
        }
        function Load() 
        {
            if(localStorage.charInv != "" && localStorage.charInv != "[]")
            {
                 charInv = JSON.parse(localStorage.charInv);
                 for(i = 0; i < charInv.length; i++)
                 {
                     // chujowo jest ten okutasialy inventory zrobiony, niech sie pierdoli, kiedys tego zjeba zmienie ale kurwa aktualizacja ma byc dzisiaj chuju zajebany pierdolnij sie w leb
                     
                     charInv[i].name = itemlist[charInv[i].id - 1].name;
                     charInv[i].value = itemlist[charInv[i].id - 1].value;
                     charInv[i].img = itemlist[charInv[i].id - 1].img;
                     charInv[i].rarity = itemlist[charInv[i].id - 1].rarity;
                     charInv[i].exp = itemlist[charInv[i].id - 1].exp;
                     charInv[i].cb = itemlist[charInv[i].id - 1].cb;
                     charInv[i].tootlipText = itemlist[charInv[i].id - 1].tootlipText;
                     charInv[i].charEnergyRefill = itemlist[charInv[i].id - 1].charEnergyRefill;
                     charInv[i].jumpEnergy = itemlist[charInv[i].id - 1].jumpEnergy;
                     charInv[i].collectEnergy = itemlist[charInv[i].id - 1].collectEnergy;
                     charInv[i].equipable = itemlist[charInv[i].id - 1].equipable;
                 }
            }
            if(localStorage.charEq != "" && localStorage.charInv != "[]")
            {
                
                charEq = JSON.parse(localStorage.charEq);
                    
                     if(charEq.head.item.id)
                     {
                     charEq.head.item.name = itemlist[charEq.head.item.id - 1].name;
                     charEq.head.item.value = itemlist[charEq.head.item.id - 1].value;
                     charEq.head.item.img = itemlist[charEq.head.item.id - 1].img;
                     charEq.head.item.rarity = itemlist[charEq.head.item.id - 1].rarity;
                     charEq.head.item.exp = itemlist[charEq.head.item.id - 1].exp;
                     charEq.head.item.cb = itemlist[charEq.head.item.id - 1].cb;
                     charEq.head.item.tootlipText = itemlist[charEq.head.item.id - 1].tootlipText;
                     charEq.head.item.charEnergyRefill = itemlist[charEq.head.item.id - 1].charEnergyRefill;
                     charEq.head.item.jumpEnergy = itemlist[charEq.head.item.id - 1].jumpEnergy;
                     charEq.head.item.collectEnergy = itemlist[charEq.head.item.id - 1].collectEnergy;
                     charEq.head.item.equipable = itemlist[charEq.head.item.id - 1].equipable;
                     }
                     if(charEq.torso.item.id)
                     {
                     charEq.torso.item.name = itemlist[charEq.torso.item.id - 1].name;
                     charEq.torso.item.value = itemlist[charEq.torso.item.id - 1].value;
                     charEq.torso.item.img = itemlist[charEq.torso.item.id - 1].img;
                     charEq.torso.item.rarity = itemlist[charEq.torso.item.id - 1].rarity;
                     charEq.torso.item.exp = itemlist[charEq.torso.item.id - 1].exp;
                     charEq.torso.item.cb = itemlist[charEq.torso.item.id - 1].cb;
                     charEq.torso.item.tootlipText = itemlist[charEq.torso.item.id - 1].tootlipText;
                     charEq.torso.item.charEnergyRefill = itemlist[charEq.torso.item.id - 1].charEnergyRefill;
                     charEq.torso.item.jumpEnergy = itemlist[charEq.torso.item.id - 1].jumpEnergy;
                     charEq.torso.item.collectEnergy = itemlist[charEq.torso.item.id - 1].collectEnergy;
                     charEq.torso.item.equipable = itemlist[charEq.torso.item.id - 1].equipable;
                     }
                     if(charEq.gloves.item.id)
                     {
                     charEq.gloves.item.name = itemlist[charEq.gloves.item.id - 1].name;
                     charEq.gloves.item.value = itemlist[charEq.gloves.item.id - 1].value;
                     charEq.gloves.item.img = itemlist[charEq.gloves.item.id - 1].img;
                     charEq.gloves.item.rarity = itemlist[charEq.gloves.item.id - 1].rarity;
                     charEq.gloves.item.exp = itemlist[charEq.gloves.item.id - 1].exp;
                     charEq.gloves.item.cb = itemlist[charEq.gloves.item.id - 1].cb;
                     charEq.gloves.item.tootlipText = itemlist[charEq.gloves.item.id - 1].tootlipText;
                     charEq.gloves.item.charEnergyRefill = itemlist[charEq.gloves.item.id - 1].charEnergyRefill;
                     charEq.gloves.item.jumpEnergy = itemlist[charEq.gloves.item.id - 1].jumpEnergy;
                     charEq.gloves.item.collectEnergy = itemlist[charEq.gloves.item.id - 1].collectEnergy;
                     charEq.gloves.item.equipable = itemlist[charEq.gloves.item.id - 1].equipable;
                     }
                     if(charEq.legs.item.id)
                     {
                     charEq.legs.item.name = itemlist[charEq.legs.item.id - 1].name;
                     charEq.legs.item.value = itemlist[charEq.legs.item.id - 1].value;
                     charEq.legs.item.img = itemlist[charEq.legs.item.id - 1].img;
                     charEq.legs.item.rarity = itemlist[charEq.legs.item.id - 1].rarity;
                     charEq.legs.item.exp = itemlist[charEq.legs.item.id - 1].exp;
                     charEq.legs.item.cb = itemlist[charEq.legs.item.id - 1].cb;
                     charEq.legs.item.tootlipText = itemlist[charEq.legs.item.id - 1].tootlipText;
                     charEq.legs.item.charEnergyRefill = itemlist[charEq.legs.item.id - 1].charEnergyRefill;
                     charEq.legs.item.jumpEnergy = itemlist[charEq.legs.item.id - 1].jumpEnergy;
                     charEq.legs.item.collectEnergy = itemlist[charEq.legs.item.id - 1].collectEnergy;
                     charEq.legs.item.equipable = itemlist[charEq.legs.item.id - 1].equipable;
                     }
                     if(charEq.boots.item.id)
                     {
                     charEq.boots.item.name = itemlist[charEq.boots.item.id - 1].name;
                     charEq.boots.item.value = itemlist[charEq.boots.item.id - 1].value;
                     charEq.boots.item.img = itemlist[charEq.boots.item.id - 1].img;
                     charEq.boots.item.rarity = itemlist[charEq.boots.item.id - 1].rarity;
                     charEq.boots.item.exp = itemlist[charEq.boots.item.id - 1].exp;
                     charEq.boots.item.cb = itemlist[charEq.boots.item.id - 1].cb;
                     charEq.boots.item.tootlipText = itemlist[charEq.boots.item.id - 1].tootlipText;
                     charEq.boots.item.charEnergyRefill = itemlist[charEq.boots.item.id - 1].charEnergyRefill;
                     charEq.boots.item.jumpEnergy = itemlist[charEq.boots.item.id - 1].jumpEnergy;
                     charEq.boots.item.collectEnergy = itemlist[charEq.boots.item.id - 1].collectEnergy;
                     charEq.boots.item.equipable = itemlist[charEq.boots.item.id - 1].equipable;
                     }
            }

            if(localStorage.SleepX != "undefined" && localStorage.SleepY != "undefined")
            {
                SleepX = localStorage.SleepX;
                SleepY = localStorage.SleepY;
            }
            if(localStorage.collectExp != undefined)
            {
                collectExp = Number(localStorage.collectExp);
                collectLevel();
            }
            if(localStorage.GeneralExp != undefined)
            {
                GeneralExp = Number(localStorage.GeneralExp);
                GeneralLevel();
            }
            if(localStorage.jumpExp != undefined)
            {
                jumpExp = Number(localStorage.jumpExp);
                JumpLevel(); 
            }
            document.getElementById('charEnergy').innerHTML = charEnergy.toFixed(2);
        }
        window.onload = Load;
        setInterval(Save, 30000);
    </script>
    <style>
        body
        {
            color:white;
            font-size:1.25vw;
        }
        #map
        {
            background-color:#222222;
            position: absolute;
            width:100%;
            height:100%;
            top:0px;
            left:0vw;
            transition: opacity 1s;
            overflow:hidden;
            
        }
        #mapContainer
        {
            background-color:#111;
            width:100%;
            height:100%;
            position: absolute;
            top:0px;
            left:0vw;
        }
        #map .chest
        {
            width:10vw;
            border-radius: 1vw;
            position:absolute;
            transition: box-shadow 1s ease-out, filter 1s ease-out;
        }
        #map > .visited
        {
            filter: grayscale(90%);
        }
        #map .zlom
        {
            background-color:purple;
            width:3vw;
            height:3vw;
            position:absolute;
        }
        #map .puste
        {
            border-radius: 1vw;
            width:10vw;
            transition: box-shadow 1s ease-out, filter 1s ease-out;
            position:absolute;
        }
        #map .puste .loot
        {
            display:none;
        }
        .chest .loot
        {
            position:relative;
            right:20vw;
            background-color:#222222;
            min-height: 6vw;
            width:20vw;
            display:none;
            z-index:1;
            opacity:0.90;
            display:none;
            bottom:12vh;
            overflow-y:scroll;
            max-height:50vh;
        }
        .chest .loot::-webkit-scrollbar
        {
            background-color: #333333;
        }
        .chest .loot::-webkit-scrollbar-thumb
        {
            background-color: #444444;
        }
        .chest .loot .lootitem
        {
            position:relative;
            cursor:pointer;
            width:90%;
            transition: background-color 0.5s;
            opacity:0.99;

        }
        .chest .loot .lootitem:hover
        {
            background-color: #333333;
        }
        .chest .loot .lootitem img
        {
            height:5vw;
            width:5vw;
        }
        .chest .loot .lootitem .name
        {
            display:inline;
            position:absolute;
            top:2vw;
            left:7vw;
            z-index:-1;
            
        }
        .chest .loot .close
        {
            position:sticky;
            height:1.5vw;
            width:1.5vw;
            cursor:pointer;
            float:right;
            z-index: 1;
        }
        #charInv
        {
            position:absolute;
            background-color:#444444;
            left:2vw;
            height:98vh;
            width:37vw;
            overflow-y: scroll;
            overflow-x:hidden;
            display:none;
            z-index:3;
            /* transition: left 0.5s ease-in; */
        }
        #craftingMenu
        {
            position:absolute;
            background-color:#444444;
            left:25vw;
            top:20vh;
            height:40vh;
            width:50vw;
            display:flex;
            justify-content: space-around;
            align-items:center;
            z-index:1;
        }
        #craftingMenu #LeftItem
        {
            cursor: pointer;
            background-color:#555;
            width: 5vw;
            height:5vw;
        }
        .craftingImg
        {
            cursor: pointer;
            width:5vw;
            height:5vw;
        }
        #craftingMenu #RightItem
        {
            
            cursor: pointer;
            background-color:#555;
            width: 5vw;
            height:5vw;
        }
        #craftingMenu #craftingResult
        {
            cursor: pointer;

            background-color:#555;
            width: 5vw;
            height:5vw;
        }
        .exit
        {
            position:absolute;
            right:0.5cm;
            top:0.5cm;
            cursor:pointer;

        }
        #charInv img
        {
            width:5vw;
            height:5vw;
        }
        #charInv .name
        {
            position:relative;
            bottom:5vw;
            left:6vw;
        }
        #charInv .value
        {
            position:relative;
            bottom:5vw;
            left:6vw;
            
        }
        #charInv .amount
        {
            position:relative;
            left:6vw;
            bottom:5vw;
        }
        #charInv .invItemUsable
        {
            height:5vw;
            margin-bottom:1vh;
            cursor:pointer;
            transition: background-color 0.3s;
        }
        #charInv .invItemUsable:hover
        {
            height:5vw;
            margin-bottom:1vh;
            cursor:pointer;
            background-color:#555555;
        }
        #charInv .invItemUnusable
        {
            height:5vw;
            margin-bottom:1vh;
        }
        #charInv::-webkit-scrollbar-track
        {
            background-color: #222222;
        }
        #charInv::-webkit-scrollbar-thumb
        {
            background-color: #555555;
        }
        #charInv::-webkit-scrollbar
        {
            width:1em;
        }
        #charInvToggle
        {
            background-color: #333333;
            width:10vw;
            z-index:3;
            padding:1vw;
            text-align:center;
            position:absolute;
            top:1vh;
            left:1vw;
            cursor:pointer;
            /* transition: left 0.5s ease-in; */
        }
        #MapGenerateButton
        {
            position:absolute;
            right:10px;
            width:100px;
            background-color:#333333;
            padding:1vh;
            cursor:pointer;
            text-align:center;
            z-index:3;
        }
        .laweczka
        {
            position:absolute;
            width: 10vw;
            
            color:black;
            padding:2vw;
        }
        .laweczka .loot
        {
            display:none;
            visibility: hidden;
        }
        #charEnergy
        {
            position:absolute;
            background-color:yellow;
            z-index:3;
            color:black;
            width:8vw;
            padding:1px;
            text-align:center;
            left:50%;
            right:50%;
            cursor:default;
        }
        #SaveWipeButton
        {
            z-index:3;
            position:absolute;
            bottom:4vh;
            right:0px;
            background-color:#333;
            padding:1vh;
            width:8vw;
            cursor:pointer;
        }
        #SaveWipeConfirmation
        {
            position:absolute;
            z-index:5;
            background-color:#bbb;
            width:50vw;
            height:50vh;
            left:25vw;
            top:25vh;
            text-align:center;
            color:black;
        }
        .WipeMsg
        {
            position:relative;
            top:5%;
        }
        .WipeYes
        {
            position:absolute;
            left:20%;
            top:40%;
            background-color:lawngreen;
            padding:5%;
            width:10%;
            cursor:pointer;
        }
        .WipeNo
        {
            position:absolute;
            right:20%;
            top:40%;
            background-color:red;
            padding:5%;
            width:10%;
            cursor:pointer;
        }
        #StatsToggle
        {
            background-color: #333333;
            width:10vw;
            z-index:3;
            padding:1vw;
            text-align:center;
            position:absolute;
            top:1vh;
            left:14vw;
            cursor:pointer;
        }
        #craftingButton
        {
            background-color: #333333;
            width:10vw;
            z-index:1;
            padding:1vw;
            text-align:center;
            position:absolute;
            top:1vh;
            left:27vw;
            cursor:pointer;
        }
        #stats
        {
            position:absolute;
            background-color:#444444;
            left:2vw;
            height:98vh;
            width:35vw;
            overflow-y: scroll;
            overflow-x:hidden;
            display:none;
            z-index:2;
        }
        .MsgIntro
        {
            position:absolute;
            z-index:5;
            background-color:#bbb;
            width:50vw;
            height:25vh;
            left:25vw;
            top:10vh;
            text-align:center;
            color:black;
        }
        .Msg
        {
            position:absolute;
            z-index:5;
            background-color:#bbb;
            width:50vw;
            height:50vh;
            max-height:75vh;
            left:25vw;
            top:10vh;
            text-align:center;
            color:black;
        }
        .MsgContent
        {
            position:relative;
            top:5%;
        }
        .MsgYes
        {
            position:absolute;
            left:20%;
            background-color:lawngreen;
            padding:5%;
            width:10%;
            cursor:pointer;
        }
        .MsgNo
        {
            position:absolute;
            right:20%;
            
            background-color:red;
            padding:5%;
            width:10%;
            cursor:pointer;
        }
        .gownoYN
        {
            bottom:3vh;
        }
        #gownoButton
        {
            z-index:3;
            position:absolute;
            bottom:10vh;
            width:8vw;
            right:0px;
            text-align:center;
            background-color:#333;
            padding:1vh;
            cursor:pointer;
        }
        #intro
        {
            margin-left:auto;
            margin-right:auto;
            position:relative;
            top:5vh;
        }
        .LevelYes
        {
            position:absolute;
            left:20%;
            top:40%;
            background-color:lawngreen;
            padding:5%;
            width:10%;
            cursor:pointer;
        }
        #charItems
        {
            position:relative;
            top:5vh;
        }
        #charEquipped .charEqItem
        {
            position:relative;
            top:1vw;
            height:7vw;
        }
        #charEquipped .charEqItem .charEqNameNoItem
        {
            position: relative;
            font-size: 2vw;
            display:inline;
        }
        #charEquipped .charEqItem .charEqName
        {
            position: absolute;
            font-size: 2.5vw;
            display:inline;
            top:0.9vw;
        }
        #charEquipped .charEqItem .charEqTooltip
        {
            background-color:#333;
            opacity:0.90;
            top:0px;
            position:absolute;
            visibility: hidden;
        }
        #charEquipped .charEqItem:hover .charEqTooltip
        {
            visibility: visible;
        }

    </style>
</head>
<body>
    <div id="charInvToggle" onclick="charInventoryToggle()">Inventory</div>
    <div id="StatsToggle" onclick="StatsToggle()">Statistics</div>
    <div id="stats" style="display:none;"></div>
    <div id="MapGenerateButton" onclick="MapGenerate('first')">Sleep</div>
    <div id="SaveWipeButton" onclick="document.getElementById('SaveWipeConfirmation').style.display='block'">Delete save</div>
    <div id="SaveWipeConfirmation" style="display:none;"><div class="WipeMsg">Are you sure?</div><div class="WipeYes" onclick="localStorage.clear(); document.getElementById('SaveWipeConfirmation').style.display='none'; location.reload()">Yes</div><div class="WipeNo" onclick="document.getElementById('SaveWipeConfirmation').style.display='none';">No</div></div>
    <div class="Msg" id="Msg" style="display:none;"><div id="MsgContent">Are you sure?</div><div class="LevelYes" onclick="document.getElementById('Msg').style.display='none';">OK</div></div>

    <div id="charEnergy">200.00</div>
    <div id="craftingButton" onclick="document.getElementById('craftingMenu').style.visibility = 'visible';">Craft</div>
    <div id="craftingMenu" style="visibility:hidden;">
        <img src="img/exit.png" class="exit" onclick="document.getElementById('craftingMenu').style.visibility = 'hidden';"/>
        <div id="LeftItem" onclick="OpenCrafting('Left')"></div>
        <div id="plusSymbol">+</div>
        <div id="RightItem" onclick="OpenCrafting('Right')"></div>
        <div id="resultSymbol">-></div>
        <div id="craftingResult"></div>
    </div>
    <div id="mapContainer">
    <div id="map">
        
    </div>
    </div>
    <div id="charInv" style="display:none;">
        
    </div>     
</body>
</html>